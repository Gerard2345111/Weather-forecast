<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Advanced Weather App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<div class="app">

  <!-- HEADER -->
  <header>
    <div class="header-left" onclick="openProfile()">
      <img id="profilePic" class="profile-pic"
        src="https://i.pinimg.com/736x/11/69/6a/11696a79c0895e164359cbab5c3073b5.jpg">
      <span id="username">Gerard Weather-forecast</span>
    </div>

    <div class="header-buttons">
      <button id="toggleTheme">üåô</button>
      <button onclick="refreshWeather()">üîÑ</button>
      <button onclick="toggleUnit()">üå°</button>
    </div>
  </header>

  <input type="file" id="uploadPic" accept="image/*" hidden>

  <!-- SEARCH -->
  <div class="search-box">
    <input type="text" id="cityInput" placeholder="Search city">
    <button onclick="searchCity()">Search</button>
  </div>

  <button class="location-btn" onclick="useLocation()">üìç My Location</button>

  <div id="timeBox" class="time-box"></div>
  <div id="alertBox" class="alert-box"></div>
  <div class="loader" id="loader"></div>

  <div id="currentWeather"></div>
  <div id="extraInfo" class="info-grid"></div>

  <h3 class="section-title">üïí Hourly Forecast</h3>
  <div id="hourlyForecast" class="hourly"></div>

  <canvas id="tempChart"></canvas>

  <h3 class="section-title">üìÖ 5-Day Forecast</h3>
  <div id="forecast"></div>
</div>

<!-- ================== STYLE ================== -->
<style>
* {
  box-sizing: border-box;
  font-family: "Segoe UI", sans-serif;
}

body {
  margin: 0;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: linear-gradient(to right,#4facfe,#00f2fe);
}

body.dark {
  background: linear-gradient(to right,#020617,#1e293b);
  color: white;
}

.app {
  width: 100%;
  max-width: 420px;
  padding: 20px;
  border-radius: 20px;
  background: rgba(255,255,255,0.25);
  backdrop-filter: blur(15px);
}

/* HEADER */
header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
}

.profile-pic {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid white;
}

#username {
  font-weight: bold;
}

.header-buttons button {
  margin-left: 5px;
}

button {
  border: none;
  border-radius: 8px;
  padding: 8px 12px;
  cursor: pointer;
}

.search-box {
  display: flex;
  gap: 8px;
  margin: 15px 0;
}

.search-box input {
  flex: 1;
  padding: 10px;
  border-radius: 8px;
  border: none;
}

.location-btn {
  width: 100%;
  background: #0ea5e9;
  color: white;
  margin-bottom: 10px;
}

.time-box {
  text-align: center;
  font-size: 14px;
}

.alert-box {
  display: none;
  padding: 10px;
  border-radius: 10px;
  font-size: 13px;
  text-align: center;
}

.alert-hot { background: #f97316; color: white; }
.alert-rain { background: #3b82f6; color: white; }
.alert-storm { background: #7c3aed; color: white; }
.alert-cold { background: #0ea5e9; color: white; }

.loader {
  display: none;
  width: 40px;
  height: 40px;
  border: 4px solid #ccc;
  border-top: 4px solid #0284c7;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 15px auto;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.weather-card {
  text-align: center;
}

.temp {
  font-size: 52px;
  font-weight: bold;
}

.info-grid {
  display: grid;
  grid-template-columns: repeat(2,1fr);
  gap: 10px;
}

.info-grid div {
  background: rgba(255,255,255,0.35);
  padding: 10px;
  border-radius: 12px;
  text-align: center;
}

.hourly {
  display: flex;
  gap: 10px;
  overflow-x: auto;
}

.hourly div {
  min-width: 70px;
  background: rgba(255,255,255,0.35);
  padding: 8px;
  border-radius: 12px;
  text-align: center;
}
</style>

<!-- ================== SCRIPT ================== -->
<script>
const apiKey = "085fa26c05d59d28da9e0131a6c35c3c";
let unit = "metric";
let lastCity = "";
let chart;

const loader = document.getElementById("loader");
const currentWeather = document.getElementById("currentWeather");
const forecastDiv = document.getElementById("forecast");
const hourlyDiv = document.getElementById("hourlyForecast");
const alertBox = document.getElementById("alertBox");

/* THEME */
document.getElementById("toggleTheme").onclick =
  () => document.body.classList.toggle("dark");

/* TIME */
setInterval(() => {
  const now = new Date();
  timeBox.innerHTML =
    `<strong>${now.toLocaleTimeString()}</strong><br>${now.toDateString()}`;
}, 1000);

/* PROFILE PICTURE */
const profilePic = document.getElementById("profilePic");
const uploadPic = document.getElementById("uploadPic");

const savedPic = localStorage.getItem("profilePic");
if (savedPic) profilePic.src = savedPic;

function openProfile() {
  uploadPic.click();
}

uploadPic.onchange = () => {
  const file = uploadPic.files[0];
  const reader = new FileReader();
  reader.onload = () => {
    profilePic.src = reader.result;
    localStorage.setItem("profilePic", reader.result);
  };
  reader.readAsDataURL(file);
};

/* WEATHER */
function searchCity(){
  lastCity = cityInput.value;
  fetchWeather(lastCity);
}

function refreshWeather(){
  if(lastCity) fetchWeather(lastCity);
}

function toggleUnit(){
  unit = unit === "metric" ? "imperial" : "metric";
  if(lastCity) fetchWeather(lastCity);
}

function useLocation(){
  navigator.geolocation.getCurrentPosition(pos=>{
    fetchWeatherByCoords(pos.coords.latitude,pos.coords.longitude);
  });
}

function fetchWeather(city){
  loader.style.display="block";
  fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&units=${unit}&appid=${apiKey}`)
    .then(r=>r.json())
    .then(d=>{
      loader.style.display="none";
      displayCurrent(d);
    });
}

function fetchWeatherByCoords(lat,lon){
  fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=${unit}&appid=${apiKey}`)
    .then(r=>r.json())
    .then(d=>{
      lastCity=d.name;
      displayCurrent(d);
    });
}

function displayCurrent(d){
  currentWeather.innerHTML = `
    <div class="weather-card">
      <h2>${d.name}</h2>
      <div class="temp">${Math.round(d.main.temp)}¬∞</div>
      <p>${d.weather[0].description}</p>
    </div>`;
}
</script>

</body>
</html>